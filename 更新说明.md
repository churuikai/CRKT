# CRK-Translator 更新说明

## 🎉 新功能

### 1. 智能语言检测与翻译
- **自动识别源语言**：系统能自动检测选中文本的语言（支持中文、英文、日语、韩语、俄语等）
- **智能翻译方向**：
  - 中文 → 英文
  - 英文 → 中文
  - 其他语言 → 可在设置中配置目标语言
  - 当源语言与目标语言相同时，自动切换为中英互译

### 2. 目标语言设置
- 新增"语言设置"标签页，可自定义默认目标语言
- 支持语言：英文、中文、日语、韩语、法语、德语、西班牙语、俄语

### 3. 增强的提示词系统
- "技能管理"更名为"提示词管理"，更清晰易懂
- 新增占位符支持：
  - `{selected_text}` - 选中的文本
  - `{source_language}` - 当前语言（本地语言名称）
  - `{source_language_en}` - 当前语言（英文名称）
  - `{target_language}` - 目标语言（本地语言名称）
  - `{target_language_en}` - 目标语言（英文名称）

## ✨ 体验优化

### 1. 窗口交互改进
- **托盘图标单击**：现在单击托盘图标即可快速显示/隐藏翻译窗口
- **窗口状态管理**：优化了窗口最小化、关闭等状态的处理逻辑
- **设置窗口**：改为非模态窗口，可以在设置时继续使用翻译功能

### 2. 性能提升
- **优雅的线程中断**：改进翻译线程停止机制，避免强制终止造成的问题
- **更快的响应**：优化了翻译流式输出的显示频率
- **智能缓存**：改进缓存管理机制，提升重复翻译的速度

### 3. 剪贴板优化
- 简化文本获取逻辑，提高稳定性
- 智能恢复剪贴板内容，不影响正常使用

## 🔧 技术改进

### 架构优化
- 移除冗余的 API 模块层，直接使用 OpenAI 官方库
- 优化代码结构，提高可维护性
- 改进错误处理机制

### 代码质量
- 重构 JavaScript 执行逻辑，减少重复代码
- 优化信号和槽的连接管理
- 改进线程安全性

## 📝 使用建议

1. **首次使用新版本**：
   - 打开设置 → "语言设置" → 根据需求配置目标语言
   
2. **自定义提示词**：
   - 使用新的占位符可以创建更智能的翻译提示词
   - 示例：`将以下{source_language}文本翻译为{target_language}：{selected_text}`

3. **快捷操作**：
   - 单击托盘图标快速显示/隐藏窗口
   - 设置窗口可以保持打开状态，方便随时调整

## 🐛 修复问题

- 修复了窗口关闭时线程未正确停止的问题
- 修复了剪贴板恢复可能失败的问题
- 改进了窗口状态同步的稳定性

---

**感谢使用 CRK-Translator！**

